
# ブレインストーミング
- なにかあれば
- 今後、experimental21はとめて切り分けてexperimental22に進むとして、ロードマップの素材は？
  - Seq
  - 音源側
    - Synth
    - Sampler
  - UI
    - Keyboard（白鍵と黒鍵など）
    - Keyboard（カットオフツマミ）
    - Keyboard（ランダムフレーズ生成ボタン）
  - ランダムフレーズ以外にも生成
    - 例、ブレインストーミング
    - ランダム音色選択（プリセットから選択）、音色パラメータ、saw, fm filter, ほかあれば

# 21をクローズに向けて進める
## ロードマップ
### 残課題の可視化、整理
### 残課題の解決
#### 仕様が曖昧だった。修正する
#### 機能が未実装だった。実装する
#### エンバグが発覚した。修正する
### README文言を作成する。ドキュメント末尾を参照のこと

# 21の操作手順、後述、を、ここにまとめて、後から読んで使うとき楽にする
- generator部
  - 起動時の自動prerender
    - 手順
      - 起動します。
      - `generator`に波形が表示されることを確認します。
      - `ファイル保存ダイアログ`が開くことを確認します。
        - `wavファイル`をローカルに保存できることを確認します。
        - wavファイル内容が、`seq`で指定したとおりの `Saw 3和音chord` であることを確認します。
      - さらに`ファイル保存ダイアログ`が開くことを確認します。
        - wavファイル内容が、`seq`で指定したとおりの `Saw Bass Octave重ね` であることを確認します。
- sampler部
  - 起動時のgeneratorからのwav自動受信
    - 手順
      - `sampler`に波形が表示されていることを確認します。
        - ※これは、generatorにて、起動時prerenderされた波形です
      - `play`ボタンを押します。
        - ※playボタンは、`seq(samper)` 部にあります
        - LRにpanがふられた曲が無限ループで演奏されることを確認します。
  - button
    - prerender
      - ※この機能は、現在演奏中の曲を、prerenderしてwavファイルに保存します。用途は、後述の`wav import`で取り込んで`セルフサンプリング`に使う等を想定しています。
      - 手順
        - `play`ボタンを押し、LRにpanがふられた曲が無限ループで演奏されることを確認します。
        - prerenderボタンを押します。
        - `ファイル保存ダイアログ`が開くことを確認します。
        - wavファイル内容が、`LRにpanがふられた曲`の1ループ、であることを確認します。
    - wav import
      - ※この機能は、任意の`wav`ファイルをsampler部に`読み込み`、seq部のシーケンスデータで演奏します。さらにそれをprerenderして`wav保存`もできます。
      - ※用途は、prerenderでwavファイルを保存してimportしそれをprerenderしてwav保存…を繰り返す`セルフサンプリング`等を想定しています。
      - 手順
        - wav importボタンを押します。
        - `ファイルアップロードダイアログ`が開くことを確認します。
          - `起動時の自動prerender`で保存済みのwavをuploadします。
            - たしかch1.wav とかch2.wavとかのファイル名制限があったはず
            - 保存時に ch1.wav とch2.wavというファイル名にする手順にしておくといい
            - bassのwavをimportすると、波形がbass表示 sampler になるし、playボタンでplayすると、Lにpanがふられたbass音色、のみでbass seqとmelody seqが鳴る、のを確認する、という手順を整理する
            - 波形表示 確認？
            - 演奏？playボタン？
          - さらにもう1つ、`起動時の自動prerender`で保存済みのwavをuploadします？
            - 演奏？確認？
          - now writing...
        - now writing...

# セルフサンプリング問題の課題のブレインストーミング、洗い出し、整理
- 手駒不足
  - 必要な手駒は、セルフサンプリングで使うdetune, octave重ね, pan, delay, chorus、
    - FM /AM 、wavどうしで、パラメータもあわせて必要
    - それらの具体的な用途のリスト
      - ここが一番重要
        - このリストを作るには、そもそもpostmate-midiでどれくらい、
          - そういった用途で使うことになるか、
            - の実証実験、検証、利用データ集め、そのための実装、が必要
  - 要は、現段階でセルフサンプリングのための十分な実装をしようとするのは、時期尚早である、と判断する

# 21の残課題
- 済 エンバグ修正
  - 済 プリレンダ済みwavの波形表示に失敗している。20のときは成功していた。
- 済 機能追加
  - 済 wav import
    - 済 import後のvisualizeを実現する。
  - 済 セルフサンプリング
    - 済 プリレンダしたものを、seqとsamplerのsynthで加工し、さらにプリレンダの入力にする、を実現する
      - ※具体的には、sampler側で起動時prerenderし、自動でwavダウンロードダイアログopenされるので、
        - 手動でwavダウンロードのち、wav importして、prerenderボタンを押すことで、
        - セルフサンプリングとなる。
        - これがexperimental21の要点。
          - 課題、これが一見してわかりづらいので、対策が必要。
- 検討する
  - 検討中 : 使い方のdemoとしてわかりづらい。候補を洗い出して整理する
    - 候補、21はcloseとし、22で使い方のdemoを一つ絞って実現する。例えばdetune重ねと、5th重ね、をそれぞれプルダウンメニューで選んで、1回ずつかける。効果がはっきりわかることが重要。
  - 検討中 : self samplingすると、それがそのままsamplerの波形に反映されている。それでよいのか？ほかの選択肢は？
    - 検討あとまわし
  - オートでセルフサンプリング
      - これまでの課題
          - オートでtone generatorでgenerateした
          - 21のテーマは、セルフサンプリングである
              - だが忘れた
              - 分析
                  - 手で操作が必要なせい（セルフサンプリングについて）
              - 対策
                  - オートでやる、testしやすくする
                      - 以下wavを、オートで生成して、dialogを開く
                          - mixdown wav bass chord
  - 機能の可視化
    - 以下機能を、起動したときからわかりやすく
      - オートセーブダイアログオープン : プリレンダ結果のwav3つを、ローカルにセーブするためのダイアログを、オートで開く。開発の円滑化用の機能。
      - オートプリレンダ : 起動時にtoneをプリレンダする。
      - オートセルフサンプリング : 起動時に、toneを使って鳴らしたtrackを、セルフサンプリングする。
  - ボタン有無の整理
    - 以下のボタンがあったほうがわかりやすい。一方で、起動直後にautoで全部済ませる場合は、ボタンがないほうが見た目はわかりやすい。なんらかの説明ドキュメントが21に付属していればどちらでもOKかも。整理する。
    - tone generateボタン
      - seq1を使ってtoneをgenerateし、samplerにわたす
    - self samplingボタン
      - seq2を使ってtrackを演奏したもの、をセルフサンプリングし、wavファイルとしてローカルにセーブする用のdialogを開く
    - 案、自動でボタン出現
      - 最後にプリレンダしたときのseq内容を、generatorとsamplerが記憶しておく。
        - そこからseq内容が変化した場合、tone generateボタンや、self samplingボタンが表示される。
          - 用途は、seq1を手で変更してtone generateすることで、「起動時とは違う音色」を作る用。
            - 関連、プルダウンとの関係。
            - 課題、現在はそもそも「プルダウンで選ぶ1,2」をまとめて生成しているので、表示されているseqからの生成はできない想定。
              - 案、textareaには、もう1次元配列を増やした、複数音色を記述とする。
                - プルダウンに入る内容も、1つのプルダウンに複数音色となる。
                - プルダウン1はデフォルトでレンダリングする音色。
                - プルダウン2は「違う音色にもできる」ことのサンプル用。
                - textareaは自由に編集できて「さらに違う音色をその場で作れる」ことのサンプル用。
  - 22に進むか？
    - 課題、ジレンマがある。シンプルにexperimental21をコンパクトに終了させ、22に進んで検証がよさげ。
    - 一方で、21に懸念がある。検証不足、機能不足、これでは実証実験としては不足で、ほかに進んでもここが中途半端だとボトルネックになるのではという懸念がある。
    - 対策、仮説、21をシンプルに終了させたのち、22などを検証していくことで、21に不足があったか？があとから見えてくる、という仮説。それを可視化して整理していく。
    - 仮説、「今21で何をやりたいか」の可視化が不足。このままだとあとからわからなくなる、という懸念。なので「あとからわかる、読みやすい」状態に21を持っていく。
    - 22に切り分ける案
      - オートで2段階セルフサンプリング
        - 今は起動時に1回セルフサンプリングをしてwav生成をしている
        - 次は別構成にして、起動時にgeneratorでprerenderしたシンプルsawを受け取ったのち、
        - sampler段で1回detuneをかけて、
        - さらにsampler段で1回octave重ねをかける
        - これをjsonで「自動操縦データ」としてやる
        - 自動操縦のメリットは、そのままテストになること

# 20と21の比較

## 21で増えた機能
### オートセーブダイアログオープン
- 20のときには無かった。
### セルフサンプリング
- たぶん今のprerenderボタン
- 20のときにはボタンすらなかった
- 課題、実装状況を失念している
### wav import
- importボタン
- 20のときにはボタンすらなかった
- オートセーブダイアログオープンでダウンロードしたwavを、1.wavと2.wavを、ch2.wavとch1.wavにrenameしてimportすることで、鳴る音色を逆にできる。
  - 課題、わかりづらい。
    - 対策案、その「逆にできる」をREADMEに明示する。ひとまずこれで。シンプル優先。
    - 対策案、tri_ch1.wav とsaw_ch1.wavを用意して、importで音色切り替えができる。
      - 課題、複雑、開発コストがかかる。対策案、保留。

## 20の時点で実現済みなもの
### auto prerender
- 21と同じ音色、同じフレーズで、wav生成済み

# Experimental21の ../README.md の草稿用：

- [Demo Experimental21 開発中](https://cat2151.github.io/postmate-midi-experimental/experimental21/)
- TODO 書く

## --- 以下、お手本、Experimental20、編集せずそのままにすること（21のお手本に使う用）
## Experimental20
- [Demo Experimental20 開発中](https://cat2151.github.io/postmate-midi-experimental/experimental20/)
- Postmate + Tone.js + 疑似MIDImessage + 簡易Seq で鳴ることの確認用。シンプルにとどめます。もしこれ以上機能追加する場合は別dirに切り分けて実施します。
- seq + prerenderer + sampler。2つのフレーズをプリレンダリングして2つのwavを生成し、それをsamplerで同時に鳴らすサンプルです。
- 19との違いは、プリレンダリングするフレーズや音色も、samplerで演奏するフレーズも、ハードコード側からデータ側に移動を進めたことです。
## --- 以上、お手本、Experimental20、編集せずそのままにすること（21のお手本に使う用）
